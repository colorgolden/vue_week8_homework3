import{a as d}from"./axios-Bo0ATomq.js";import{_ as y,c as i,a as e,F as g,f as w,g as V,h as C,t as c,b as n,w as k,r as h,o as m,n as b,i as E,d as T}from"./index-LGRT9Jh6.js";var F={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"forest_mind",BASE_URL:"/vue_week8_homework3/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:u,VITE_PATH:_}=F,U={data(){return{is_coupon:!1,pay_total:0,coupon:{code:""},cart:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},created(){this.getCart()},watch:{"$route.query":{handler(){this.getProducts()},deep:!0}},methods:{getCart(){d.get(`${u}/v2/api/${_}/cart`).then(o=>{this.cart=o.data.data.carts,this.pay_total=0,this.cart.forEach(t=>{this.pay_total+=Math.round(parseInt(t.final_total))})}).catch(o=>{console.dir(o)})},createOrder(){const o=this.form;d.post(`${u}/api/${_}/order`,{data:o}).then(t=>{console.log(t),this.$router.push("checkout-success"),this.$refs.form.resetForm()}).catch(t=>{alert(t.response.data.message)})},useCoupon(){d.post(`${u}/api/${_}/coupon`,{data:this.coupon}).then(()=>{this.is_coupon=!0,this.getCart()}).catch(o=>{alert(o)})},delOneCart(o){d.delete(`${u}/api/${_}/cart/${o}`).then(()=>{alert("成功刪除品項"),this.getCart()}).catch(t=>{alert("沒有刪除品項，請再試一次"),console.log(t.message)})},delAllCarts(){d.delete(`${u}/api/${_}/carts`).then(()=>{alert("成功清空購物車"),this.$router.push("products")}).catch(o=>{alert("操作有誤，若無法直接下訂請聯繫我們"),console.log(o.message)})}}},A={class:"container"},M=e("div",{class:"row justify-content-center"},[e("h3",{class:"fw-bold mb-4 pt-3"},"結帳")],-1),N={class:"row flex-row-reverse justify-content-center pb-5"},O={class:"col-md-5"},j={class:"border p-4 mb-4"},R=["src"],S={class:"w-100 pb-3"},q={class:"d-flex justify-content-between"},D={class:"mb-0 fw-bold"},I=["onClick"],$={class:"mb-0 fw-bold"},B=e("br",null,null,-1),L={class:"mb-0 text-end"},P={key:0},H={class:"mb-0 text-end"},z={class:"mb-0 text-end"},G={key:1},J={class:"mb-0 text-end"},K={class:"p-3 d-flex justify-content-end"},Q={class:"table mt-4 border-top text-muted"},W=e("tr",null,[e("th",{scope:"row",class:"border-0 px-0 pt-4 pb-4 font-weight-normal"},"付款方式"),e("td",{class:"text-end border-0 px-0 pt-4 pb-4"},"線上付款")],-1),X={class:"input-group mb-3 w-100"},Y={class:"input-group-append"},Z={class:"d-flex justify-content-between mt-4"},ee=e("p",{class:"mb-0 h4 fw-bold"},"總金額",-1),te={class:"mb-0 h4 fw-bold"},se={class:"col-md-7"},oe=e("p",null,"聯絡資訊",-1),le={class:"mb-0"},ae={class:"mb-3"},ne={class:"mb-2"},re=e("label",{for:"name",class:"form-label"},"姓名",-1),ce={class:"mb-2"},de=e("label",{for:"tel",class:"form-label"},"電話",-1),ie=e("label",{for:"ContactMail",class:"text-muted mb-0"},"電子信箱",-1),me={class:"mb-2"},ue=e("p",{class:"mt-4"},"訂單備註",-1),_e={class:"d-flex flex-column-reverse flex-md-row mt-4 justify-content-between align-items-md-center align-items-end"},pe=e("a",{href:"./product.html",class:"text-dark mt-md-0 mt-3"},[e("i",{class:"fas fa-chevron-left me-2"}),T(" 上一步")],-1);function he(o,t,be,fe,l,r){const p=h("VeeField"),f=h("error-message"),v=h("ErrorMessage"),x=h("VeeForm");return m(),i("div",A,[M,e("div",N,[e("div",O,[e("div",j,[(m(!0),i(g,null,w(l.cart,s=>(m(),i("div",{key:s.id,class:"d-flex"},[e("img",{src:s.product.imageUrl,alt:"",class:"me-2",style:{width:"48px",height:"48px","object-fit":"cover"}},null,8,R),e("div",S,[e("div",q,[e("p",D,c(s.product.title),1),e("button",{type:"button",onClick:a=>r.delOneCart(s.id),class:"btn-close","aria-label":"Close"},null,8,I)]),e("p",$,"人數："+c(s.qty)+"位",1),B,e("p",L,"NT$ "+c(s.product.price),1),l.is_coupon==!0?(m(),i("span",P,[e("p",H,[e("del",null,"小計 NT$ "+c(s.total),1)]),e("p",z,"小計 NT$ "+c(Math.round(s.final_total)),1)])):(m(),i("span",G,[e("p",J,"小計 NT$ "+c(s.total),1)]))])]))),128)),e("div",K,[e("button",{type:"button",onClick:t[0]||(t[0]=(...s)=>r.delAllCarts&&r.delAllCarts(...s)),class:"btn btn-danger"},"清空購物車")]),e("table",Q,[e("tbody",null,[W,e("tr",null,[e("div",X,[V(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=s=>l.coupon.code=s),placeholder:"請輸入折扣碼，按下「折抵」來使用","aria-label":"Recipient's username","aria-describedby":"basic-addon2"},null,512),[[C,l.coupon.code]]),e("div",Y,[e("button",{class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=(...s)=>r.useCoupon&&r.useCoupon(...s)),style:{"background-color":"#F6F5EF",color:"#41774A"},type:"button"},"折抵")])])])])]),e("div",Z,[ee,e("p",te,"NT$ "+c(this.pay_total),1)])])]),e("div",se,[n(x,{ref:"form",class:"col-md-6",onSubmit:r.createOrder},{default:k(({errors:s})=>[oe,e("div",le,[e("div",ae,[e("div",ne,[re,n(p,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":t[3]||(t[3]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),n(f,{name:"姓名",class:"invalid-feedback"})]),e("div",ce,[de,n(p,{id:"tel",name:"電話",type:"text",class:b(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"numeric|min:9",modelValue:l.form.user.tel,"onUpdate:modelValue":t[4]||(t[4]=a=>l.form.user.tel=a)},null,8,["class","modelValue"]),n(f,{name:"電話",class:"invalid-feedback"})]),ie,n(p,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":t[5]||(t[5]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),n(v,{name:"email",class:"invalid-feedback"}),e("div",me,[ue,n(p,{id:"address",as:"textarea",name:"備註",type:"text",class:b(["form-control",{"is-invalid":s.備註}]),placeholder:"請輸入交通方式，或有其他想告訴我們的。 ：）",rows:"3",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":t[6]||(t[6]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),n(f,{name:"訂單備註",class:"invalid-feedback"})])]),e("div",_e,[pe,e("button",{class:"btn btn-primary",style:{"background-color":"#41774A"},type:"submit",onClick:t[7]||(t[7]=E((...a)=>r.createOrder&&r.createOrder(...a),["prevent"])),to:"./checkout-success.html"},"確認送出")])])]),_:1},8,["onSubmit"])])])])}const ye=y(U,[["render",he]]);export{ye as default};
